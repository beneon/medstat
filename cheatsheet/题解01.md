# 题解01

## 利用中值极限定理估计I类和II类错误概率

给定正常总体平均值$\mu$, 总体标准差$\sigma$, 

给定异常搜字体平均值$\mu_{异常}$, 总体标准差$\sigma_{异常}$

判断临界值: 左侧为$X_L$, 右侧为$X_R$, 样本量N


### 例题

> 一台机器，平均每袋装2kg ($\mu$)材料，标准差是0.2kg ($\sigma$)。管理人员想检查一下机器有没有故障，所以随机抽取了64 (N)个袋子称取重量。并且事先决定，如果平均每个容器装材料质量在1.95kg ($X_L$)或者2.05kg ($X_R$)之间就认为机器没有问题
> 
> （1）那么现在假设机器工作是正常的，那么管理人员有多大的可能是错了的？
>
> （2）假定机器实际上需要修理，并且每个袋子平均装入的是1.94 kg ($\mu_{异常}$)材料，标准差是0.14 kg ($\sigma_{异常}$)，在现在的判定标准下，管理人员有多大的可能出错？要怎么评价这套标准好不好用？

### 解题步骤

求I类错误概率


1. 计算标准误
   
    $SE=\frac{\sigma}{\sqrt{N}}$

2. 计算平均值是$\mu$, 标准差是$SE$的正态分布曲线, $X_L$左侧的曲线下面积$AUC_{<L}$使用Excel公式求解: `=norm.dist(x, mean, stardard_dev, TRUE)`, 其中`x`使用$X_L$的值, `mean`使用$\mu$的值, `standard_dev`使用标准误$SE$的值. 
3. 而 $X_R$左侧的曲线下面积$AUC_{<R}$也使用上面的Excel公式求解, 其中`x`使用$X_R$的值, 其他不变: `mean`使用$\mu$的值, `standard_dev`使用标准误$SE$的值.
4. 在当前的判断临界值设置下(在$X_L$和$X_R$之间评定为接受), 如果样本确实来自总体, 则样本平均值落在接受范围内的概率是两个临界值之间的曲线下面积=$AUC_{<R}-AUC_{<L}$, I类错误概率是
   
   I类错误概率=$1-(AUC_{<R}-AUC_{<L})$

求II类错误概率

求解步骤:

1. 计算异常总体的标准误: 
   
   $SE_{异常}=\frac{\sigma_{异常}}{\sqrt{N}}$

2. 计算平均值是$\mu_{异常}$, 标准差是$SE_{异常}$的正态分布曲线, $X_L$左侧的曲线下面积$AUC_{<L(异常)}$使用Excel公式求解: `=norm.dist(x, mean, stardard_dev, TRUE)`, 其中`x`使用$X_L$的值, `mean`使用$\mu_{异常}$的值, `standard_dev`使用标准误$SE_{异常}$的值. 
3. 而 $X_R$左侧的曲线下面积$AUC_{<R(异常)}$也使用上面的Excel公式求解, 其中`x`使用$X_R$的值, 其他不变: `mean`使用$\mu_{异常}$的值, `standard_dev`使用标准误$SE_{异常}$的值.
4. 在当前的判断临界值设置下(在$X_L$和$X_R$之间评定为接受), 如果样本其实来自于异常总体, 则样本平均值落在接受范围内的概率是两个临界值之间的曲线下面积, 也就是II类错误的概率

   II类错误的概率=$AUC_{<R(异常)}-AUC_{<L(异常)}$, 
   
   当前检验的效力是
   
   检验的效力=$1-(AUC_{<R(异常)}-AUC_{<L(异常)})$

## 已知总体平均值, 标准差, 样本量的假设检验 (双侧检验)

已知总体平均值$\mu$, 总体标准差$\sigma$, 现在有一组样本, 样本量是N, 样本平均值$\bar{X}$, 求解在给定假设检验水平$p_{crit}$下, 是否拒绝零假设($H_0$), 接受备择假设($H_1$)

### 例题:

> 某地10至20岁青年身高平均值为168cm ($\mu$), 标准差为3cm ($\sigma$). 现在研究人员招募了100 (N)个当地10到20岁的有吸烟史的青年, 测量身高平均值是160cm ($\bar{X}$), 标准差4cm. 在0.05 ($p_{crit}$)检验水平下,判断这群10到20岁的有吸烟史的青年的身高平均值和当地总体平均值是否有区别?

### 解题步骤

1. 指定零假设(两者无区别)和备择假设(两者有区别)
2. 计算标准误
   
    $SE=\frac{\sigma}{\sqrt{N}}$

3. 计算平均值是$\mu$, 标准差是$SE$的正态分布曲线, 取哪两个临界值$X_L$, $X_R$可以使$1-(AUC_{<R}-AUC_{<L})=0.05$? 也就是两个临界值外侧的面积是0.05? 可以使用Excel公式求解$X_L$:
   
   `=norm.inv(probability,mean,stardard_dev)`

其中`probablity`是$\frac{p_{crit}}{2}$, 在这道题就是0.025, `mean`是 $\mu$, `standard_dev`是标准误$SE$

对于$X_R$也是使用上面的Excel公式求解, 其中: `probablity`是$1-\frac{p_{crit}}{2}$, 在这道题就是0.975, `mean`是 $\mu$, `standard_dev`是标准误$SE$

4. 现在有了$X_L$, $X_R$, 接下来判断$\bar{X}$是符合$X_L\leq\bar{X}\leq X_R$(不拒绝零假设)还是符合$\bar{X}> X_R$或者$\bar{X}< X_L$ (拒绝零假设, 接受备择假设)

## 对总体均值和标准差的估计

### 估计总体均值

记样本中各项$X_i$, 其中i=1, 2, ... n

则总体均值的估计值(或者X这个变量的期望是):

$E(X) =\bar{X}= \frac{\sum{x_i}}{N}$

例: 通过随机抽样在过去一个星期里获得9个($N$)肝胆外科病人对病房的满意度评分, 分别是 21, 33, 54, 88, 45, 64, 39, 51, 40 (分别是$X_1到X_9$). 用这些数据估计肝胆外科病人对病房的满意度评分平均分

$E(X) =\bar{X}= \frac{\sum{x_i}}{N}=\frac{21+33+54+88+45+64+39+51+40}{9}=48.333$

### 估计总体标准差, 已知总体均值的时候

记样本中各项$X_i$, 其中i=1, 2, ... n, 样本来自这样一个总体, 其平均值为$\mu$

则总体方差的估计值(或者X这个变量的期望是):

$Var(X) = \frac{\sum{(x_i-\mu)^2}}{N}$

总体标准差(s)是方差开平方
$s = \sqrt{\frac{\sum{(x_i-\mu)^2}}{N}}$

例: 通过随机抽样在过去一个星期里获得9个($N$)肝胆外科病人对病房的满意度评分, 分别是 21, 33, 54, 88, 45, 64, 39, 51, 40 (分别是$X_1到X_9$). 且已知过去一个星期里肝胆外科的所有病人对病房满意度评分的平均值是45. 用这些数据估计肝胆外科病人对病房的满意度评分的标准差

$Var(X) =  \frac{\sum{(x_i-\mu)^2}}{N}$

$= \frac{(21-45)^2+(33-45)^2+(54-45)^2+(88-45)^2+(45-45)^2+(64-45)^2+(39-45)^2+(51-45)^2+(40-45)^2}{9} = 345.333$

$s = \sqrt{Var(X)} = 18.58315$

### 估计总体标准差, 总体平均值未知

记样本中各项$X_i$, 其中i=1, 2, ... n, 样本来自的总体平均值未知

总体平均值未知, 此时用样本平均值$\bar{X}$作为总体平均值的估计值, 则总体方差的估计值(或者X这个变量的期望是):

$Var(X) = \frac{\sum{(x_i-\bar{X})^2}}{N-1}$

总体标准差(s)是方差开平方
$s = \sqrt{\frac{\sum{(x_i-\bar{X})^2}}{N-1}}$

此时自由度$d.f. = N-1$

例: 通过随机抽样在过去一个星期里获得9个($N$)肝胆外科病人对病房的满意度评分, 分别是 21, 33, 54, 88, 45, 64, 39, 51, 40 (分别是$X_1到X_9$). 用这些数据估计肝胆外科病人对病房的满意度评分的标准差

$E(X) =\bar{X}= \frac{\sum{x_i}}{N}=\frac{21+33+54+88+45+64+39+51+40}{9}=48.333$

$Var(X) = \frac{\sum{(x_i-\bar{X})^2}}{N-1}$

$=\frac{(21-48.333)^2+(33-48.333)^2+(54-48.333)^2+(88-48.333)^2+(48.333-48.333)^2+(64-48.333)^2+(39-48.333)^2+(51-48.333)^2+(40-48.333)^2}{8}=19.39072$

自由度 = 9-1 =8

## T检验

### 单样本T检验(双侧检验)

记样本中各项$X_i$, 其中i=1, 2, ... n, 样本量为$N$. 现在有一个总体, 平均值为$\mu$

在给定的检验水平下($P_{crit}$), 判断样本是否来自这个总体

步骤:

1. 确定零假设和备择假设
2. 计算T值和自由度

   $t=\frac{\bar{X}-\mu}{SE}$

   $SE=\frac{s}{\sqrt{N}}$

   $s = \sqrt{\frac{\sum{(x_i-\bar{X})^2}}{N-1}}$

   $d.f. = N-1$

3. 根据$P_{crit}$和自由度$d.f.$计算两侧的T临界值$T_L$, $T_R$
   
   $T_L = -1\times T_R$ 

    $T_R$可以用excel公式求解:`=T.INV.2T(probability, deg_freedom)`

    其中`probability`$=P_{crit}$, `deg_freedom`$=d.f=N-1$

4. 判断T值是$T_L\leq T\leq T_R$(接受零假设)还是$T>T_R或T<T_L$(拒绝零假设, 接受备择假设)

例题: 通过随机抽样在过去一个星期里获得9个($N$)肝胆外科病人对病房的满意度评分, 分别是 21, 33, 54, 88, 45, 64, 39, 51, 40 (分别是$X_1到X_9$). 而上个月肝胆外科病人对病房的满意度评分平均分是58 ($\mu$)分, 请判断在0.05 ($P_{crit}$)检验水平下, 过去一个星期病人的满意度评分平均分和一个月前是否有所不同.

1. 零假设:过去一个星期所有肝胆外科病人对病房满意度评分的平均值和上个月满意度评分的平均值**没有**差异; 
   
   备择假设: 过去一个星期所有肝胆外科病人对病房满意度评分的平均值和上个月满意度评分的平均值**有**差异
2. 计算T值和自由度
   
   $s = \sqrt{\frac{\sum{(x_i-\bar{X})^2}}{N-1}}=19.39072$

   $SE=\frac{s}{\sqrt{N}}=\frac{19.39072}{9}=6.463573$

   $t=\frac{\bar{X}-\mu}{SE} = \frac{48.333-58}{6.463573} = -1.496$

   $d.f. = N-1=9-1=8$

3. 根据$P_{crit}$和自由度$d.f.$计算两侧的T临界值$T_L$, $T_R$. 其中$T_R$`=T.INV.2T(0.05,8)=2.306004135`
4. $-2.75<-1.496<2.75$, 所以不拒绝零假设

### 配对样本T检验

1. 求配对样本之间的差$d=X_{pair1}-X_{pair2}$, (比如$d=X_{治疗前}-X_{治疗后}$)
2. 确定零假设和备择假设
3. 计算t值和自由度
4. 根据$P_{crit}$和自由度$d.f.$计算两侧的T临界值$T_L$, $T_R$
5. 判断T值是$T_L\leq T\leq T_R$(接受零假设)还是$T>T_R或T<T_L$(拒绝零假设, 接受备择假设)

例题: 通过随机抽样对过去一个星期内在肝胆外科住院的患者中抽取了9人, 在入院时和入院后进行满意度评分. 9名患者的评分情况分别是: 

1号, 入院时：21, 出院时:26; 2号, 入院时：33, 出院时:28; 3号, 入院时：54, 出院时:59; 4号, 入院时：88, 出院时:73; 5号, 入院时：45, 出院时:50; 6号, 入院时：64, 出院时:24; 7号, 入院时：39, 出院时:18; 8号, 入院时：51, 出院时:80; 9号, 入院时：40, 出院时:62.

请判断在0.05 ($P_{crit}$)检验水平下, 过去一个星期病人的满意度评分平均分和一个月前是否有所不同.

1. 首先计算d值, 对于9个病人, 分别是-5, 5, -5, 15, -5, 40, 21, -29, -22
2. 这样一来, 上面的问题就从配对样本比较转换成了9个样本, $X_1到X_9$分别是-5, 5, -5, 15, -5, 40, 21, -29, -22的单样本T检验, 用来拒绝的零假设是: 总体均值为0 (说明前后无差异)
3. t值, 自由度, $T_L$和$T_R$等值的计算和单样本T检验相同

   $s = \sqrt{\frac{\sum{(x_i-\bar{X})^2}}{N-1}}=21.40677463$

   $SE=\frac{s}{\sqrt{N}}=\frac{19.39072}{9}=7.135591543$

   $t=\frac{\bar{X}-\mu}{SE} = \frac{1.667-0}{7.135591543} = 0.233570918$

   $d.f. = N-1=9-1=8$

    $T_R$`=T.INV.2T(0.05,8)=2.306004135`

### 两个独立样本的均值比较的T检验 (等方差假设, 双向检验)

记第一组样本为$A$, 其中各项为$A_i$, 其中$i=1, 2, 3... n$, 样本量为$N_1$, 这组样本的均值记为$\bar{A}$

记第二组样本为$B$, 其中各项为$B_i$, 其中$i=1, 2, 3... m$, 样本量为$N_2$, 这组样本的均值记为$\bar{B}$.



1. 等方差假设, 有总体标准误为
   
   $SE^2 = \frac{s^2}{N_1}+\frac{s^2}{N_2}$
   
   估计总体标准差

    $s^2 = \frac{s_1^2 \times (N_1-1)+s_2^2 \times (N_2-1)}{N_1+N_2-2}$

    $s_1^2=\frac{\sum{(A_i-\bar{A})^2}}{N_1-1}$, $s_2^2=\frac{\sum{(B_i-\bar{B})^2}}{N_2-1}$

2. 用两组样本的均值计算均值的差d和t值
   
   $d = \bar{A}-\bar{B}$

3. 计算t值和自由度
   
   $t=\frac{d-0}{SE}, d.f. = N_1+N_2-2$

4. 根据$P_{crit}$和自由度$d.f.$计算两侧的T临界值$T_L$, $T_R$, $T_L=-1\times T_R$, 
   
   $T_R$`=T.INV.2T(probability,deg_freedom)`, `probability`=$P_{crit}$, `deg_freedom`=$d.f.=N_1+N_2-2$

5. 判断T值是$T_L\leq T\leq T_R$(接受零假设)还是$T>T_R或T<T_L$(拒绝零假设, 接受备择假设)

例题: 临床试验将患者随机分为治疗组和对照组, 经过治疗后测量某个生化指标的值, 治疗组结果是11, 18, 24, 24, 18, 16, 19, 12, 21, 18, 19, 16, 13, 22; 对照组结果是20, 21, 19, 26, 35, 19, 30, 31, 29, 21, 31. 请判断在0.05检验水平上, 治疗组和对照组的结果是否存在差异?

零假设:治疗组和对照组结果的均值**无**区别

备择假设:治疗组和对照组结果的均值**有**区别

1. 利用$s = \sqrt{\frac{\sum{(x_i-\bar{X})^2}}{N-1}}$可得
   
   $s_1 = \sqrt{\frac{(11-17.92)^2+ (18-17.92)^2+ (24-17.92)^2+ (24-17.92)^2+ (18-17.92)^2+...+ (22-17.92)^2}{14-1}}=4.08494$

   $s_2 = \sqrt{\frac{(20-25.63)^2+ (21-25.63)^2+ (19-25.63)^2+ (26-25.63)^2+ (35-25.63)^2+ ...+ (31-25.63)^2}{11-1}}=5.81846$

   将$s_1$和$s_2$按照自由度加权平均

    $s^2 = \frac{s_1^2 \times (N_1-1)+s_2^2 \times (N_2-1)}{N_1+N_2-2} = \frac{4.08494^2 \times (14-1)+5.81846^2 \times (11-1)}{14+11-2} = 24.1511$

    $s = \sqrt{24.1511087}= 4.91438$


2. 由等方差假设, 有总体标准误为
   
   $SE^2 = \frac{s^2}{N_1}+\frac{s^2}{N_2}=24.1511*(\frac{1}{14}+\frac{1}{11}) = 3.9206$

   $SE = \sqrt{SE^2} = 1.98$

3. 用两组样本的均值计算均值的差d和t值
   
   $d = \bar{A}-\bar{B} = 17.92-25.63=-7.71$

4. 计算t值和自由度
   
   $t=\frac{d-0}{SE}=\frac{-7.71}{1.98}=-3.8938, d.f. = N_1+N_2-2=14+11-2=23$

5. 根据$P_{crit}$和自由度$d.f.$计算两侧的T临界值$T_L$, $T_R$, $T_L=-1\times T_R$, 
   
   $T_R$`=T.INV.2T(probability,deg_freedom)`, `probability`=$P_{crit}=0.05$, `deg_freedom`=$d.f.=N_1+N_2-2=23$, 有$T_R=2.06866$

6. 判断T值是$T_L\leq T\leq T_R$(接受零假设)还是$T>T_R或T<T_L$(拒绝零假设, 接受备择假设): 有$T<T_L$, 拒绝零假设, 接受备择假设